---
description: 프
---

# 빈 스코프

## 1. 빈 스코프란?&#x20;

* 스코프는 빈이 존재할 수 있는 범위를 의미하며, 스프링은 다음과 같은 다양한 스코프를 지원한다.&#x20;
  * 싱글톤 : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프
  * 프로토타입 : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프
  * 웹 관련 스코프&#x20;
    * request : 웹 요청이 들어오고 나갈때까지 유지되는 스코프
    * session
    * application

## 2. 프로토타입 스코프

* 항상 같은 인스턴스를 제공하는 싱글톤 스코프 빈과 다르게, 프로토타입 스코프 빈은 항상 새로운 인스턴스를 생성해서 반환한다.&#x20;
* 그 흐름은 다음과 같다.
  * 프로토타입 스코프의 빈을 스프링 컨테이너에 요청한다. \
    \-> 요청하기 전까지는 빈을 생성하지 않는다.&#x20;
  * 스프링 컨테이너는 이 시점에 **프로토타입 빈을 생성하고, 필요한 의존관계를 주입**한다.\
    \-> **초기화까지 처리한다.**
  * 스프링 컨테이너는 생성한 프로토타입 빈을 클라이언트에 반환한다.&#x20;
  * 이후 스프링 컨테이너는 프로토타입을 관리하지 않고 프로토타입 빈을 요청시 새로운 인스턴스를 반환한다. \
    \-> 때문에, @PreDestroy 같은 종료 메서드가 호출되지 않는다.&#x20;

### 2-1. 싱글톤 빈과의 차이점

* **싱글톤 빈은 스프링 컨테이너 생성 시점에 초기화 메서드가 실행 되지만,** \
  **프로토타입 스코프 빈은 스프링 컨테이너에서 빈을 조회할 때 생성되고, 초기화 메서드도 실행된다.**
* **싱글톤 빈은 스프링 컨테이너가 관리하기 때문에, 스프링 컨테이너가 종료될 때 빈의 종료 메서드가 실행되지만,** \
  **프로토타입 빈은 스프링 컨테이너가 생성과 의존관계 주입 그리고 초기화까지만 관여하고 더는 관리하지 않는다.** \
  **-> 때문에, @PreDestroy 같은 종료 메서드가 호출되지 않는다.** \
  **-> 프로토타입 빈은 프로토타입 빈을 조회한 클라이언트가 직접 관리해야 한다.**&#x20;

### 2-2. 싱글톤 빈과 함께 사용했을 때 문제점

* 두 빈의 라이프사이클이 다르다는 점을 위에서 확인할 수 있다. \
  때문에, 요청때마다 새로운 빈을 생성하기 원했던 프로토타입 빈이 싱글톤 빈에 종속되어지는 상황에서는 싱글톤 빈의 라이프사이클에 따라서 하나의 인스턴스가 공유되게 된다. \
  \-> **싱글톤 빈 생성시 이미 주입이 끝난 상태이다.**&#x20;
* 이때 Provider 를 사용해 문제를 해결할 수 있다. \
  \-> **위와 같은 상황에서 스프링의 어플리케이션 컨텍스트 전체를 주입받게 되면, 스프링 컨테이너에 종속적인 코드가 되고, 단위 테스트가 어려워진다.** \
  **-> 지금 필요한 기능은 지정한 프로토타입 빈을 컨테이너에서 대신 찾아주는 기능! DL 정도의 기능을 제공하는 무언가가 필요하다.**&#x20;

```java
@Autowired
private ObjectProvider<PrototypeBean> prototypeBeanProvider;
  
public int logic() {
      PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
      prototypeBean.addCount();
      int count = prototypeBean.getCount();
      return count;
}
```

> **Dependency Lookup(DL)**
>
> * 의존관계를 외부에서 주입받는 것이 아닌, 직접 필요한 의존관계를 찾는 것을 의존관계 탐색(DL)이라고 한다.&#x20;

### 2-3. 프로토타입 빈을 언제 사용하는가?

* 매번 사용할 때 마다 의존관계 주입이 완료된 새로운 객체가 필요하면 사용하면 된다!
* 그런데 실무에서는 싱글톤 빈으로 대부분의 문제를 해결할 수 있기에 프로토타입 빈을 사용하는 경우는 드물다..
