# 4. String 클래스

## String 클래스 - 기본&#x20;

자바에서 문자를 다루는 대표적인 타입은 `char`, `String` 2가지가 있다.&#x20;

기본형인 `char` 는 문자 하나를 다룰 때 사용한다. `char` 를 사용해서 여러 문자를 나열하려면 char\[] 을 사용해야 한다. 하지만 이렇게 `char[]` 을 직접 다루는 방법은 매우 불편하기 때문에, 자바는 문자열을 매우 편리하게 다룰 수 있는 `String` 클래스를 제공한다.&#x20;

`String` 클래스를 통해 문자열을 생성하는 방법은 2가지가 있다.&#x20;

* 리터럴 사용 : `"hello"`
* 객체 생성 : `new String("hello")`

기본적으로 `String` 은 클래스이다. 기본형 타입(Primitive type) 이 아니다. 따라서 `String` 을 리터럴로 사용하는 다음의 코드는 뭔가 어색하다.&#x20;

```java
String str1 = "hello";
```

문자열은 매우 자주 사용된다. 때문에 편의상 쌍따움표로 문자열을 감싸면 자바 언어에서 `new String("hello")` 와 같이 변경해준다. (이 경우 실제로는 성능 최적화를 위해서 문자열 풀을 사용한다)&#x20;

```java
String str1 = "hello";    // 기존
String str1 = new String("hello");    // 변경    
```

## String 클래스 구조&#x20;

String 클래스 구조는 대략 다음과 같이 생겼다.&#x20;

```java
public final class String {
    
    //문자열 보관
    private final char[] value;// 자바 9 이전 
    private final byte[] value;// 자바 9 이후
    
    //여러 메서드
    public String concat(String str) {...} 
    public int length() {...}
    ...
}
```

#### 속성(필드) &#x20;

```java
private final char[] value; 
```

여기에는 `String` 의 실제 문자열 값이 보관된다. 문자 데이터 자체는 `char[]` 에 보관된다.&#x20;

`String` 클래스는 개발자가 직접 다루기 불편한 `char[]` 을 내부에 감추고 String 클래스를 사용하는 개발자가 편리하게 문자열을 다룰 수 있도록 다양한 기능을 제공한다. 그리고 메서드 제공을 넘어서 자바 언어 차원에서도 여러 편의 문법을 제공한다.&#x20;

> #### 참고 - 자바 9 이후 `String` 클래스 변경 사항&#x20;
>
> 자바 9 부터 `String` 클래스에서 `char[]` 대신에 `byte[]` 를 사용한다.&#x20;
>
> 자바에서 문자 하나를 표현하는 `char` 는 2byte 를 사용한다. 그런데 영어, 숫자는 보통 1byte 로 표현이 가능하다. 그래서 단순 영어, 숫자로만 표현된 경우 1byte 를 사용하고 그렇지 않은 경우 2byte 인 UTF-16 인코딩을 사용한다. 따라서 메모리를 더욱더 효율적으로 사용할 수 있도록 변경되었다.&#x20;
>
> 예를 들어서 `"가나다라"` 문자열을 `String` 타입으로 저장하면 **크기가 8인 `byte` 배열에 저장된다.**&#x20;

#### 기능(메서드)&#x20;

~~너무 많아서 패스..~~&#x20;

~~필요할 때 알아서 찾아쓰자;;~~&#x20;

### String 클래스와 참조형&#x20;

`String` 은 클래스이다. 따라서 기본형이 아니라 참조형이다.&#x20;

참조형은 변수에 계산할 수 있는 값이 들어있는 것이 아니라, 레퍼런스 갑시 들어있다. 따라서 원칙적으로는 `+` 같은 연산자를 사용할 수 없다.&#x20;

* 자바에서 문자열을 더할 때는 `String` 이 제공하는 `concat()` 과 같은 메서드를 사용해야 한다.&#x20;
* 하지만, 문자열은 너무 자주 다루어지기 때문에 자바 언어에서 편의상 특별히 `+` 연산을 제공한다.&#x20;

## String 클래스 - 비교&#x20;

`String` 클래스 비교할 때는 `==` 비교가 아니라 항상 `equals()` 비교를 해야한다.&#x20;

* 동일성(Identity) : `==` 연산자를 사용해서 두 객체의 참조가 동일한 객체를 가리키고 있는지 확인&#x20;
* 동등성(Equality) : `equals()` 메서드를 사용하여 두 객체가 논리적으로 같은지 확인&#x20;

```java
public class StringEqualsMain1 {
    public static void main(String[] args) {
        String str1 = new String("hello");
        String str2 = new String("hello");
        System.out.println(str1 == str2);
        System.out.println(str1.equals(str2));

        String str3 = "hello";
        String str4 = "hello";
        System.out.println(str3 == str4);   // 리터럴은 JVM 내에서 같은 값을 사용하기 때문에, 동일성 비교가 가능하다.
        System.out.println(str3.equals(str4));
    }
}
```

&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2025-04-01 17.09.43.png" alt=""><figcaption></figcaption></figure>

* `str1`, `str2` 는 기본적으로 레퍼런스 값이 다르기 때문에, 동일성 비교를 했을 때 `false` 를 반환한다.&#x20;
* `String` 클래스는 내부 문자열 값을 비교하도록 `equals()` 메서드를 재정의 해두었다.&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2025-04-01 17.10.28.png" alt=""><figcaption></figcaption></figure>

* `String str3 = "hello"` 와 같이 문자열 리터럴을 사용하는 경우 자바는 메모리 효율성과 성능 최적화를 위해서 문자열 풀을 사용한다.&#x20;
* 자바가 실행되는 시점(런타임) 에 클래스에 문자열 리터럴이 있으면 문자열 풀에 `String` 인스턴스를 만들어둔다. 이때 같은 문자열이 있으면 만들지 않는다.&#x20;
* `String str3 = "hello"` 와 같이 문자열 리터럴을 사용하면 문자열 풀에서 `"hello"` 라는 문자를 가진 `String` 인스턴스를 찾는다. 그리고 찾은 인스턴스의 참조 (x003) 을 반환한다.&#x20;
* `String str4 = "hello"` 의 경우 `"hello"` 문자열 리터럴을 사용하므로 문자열 풀에서 `str3` 과 같은 x003 참조를 사용한다.&#x20;
* **문자열 풀 덕분에 같은 문자를 사용하는 경우 메모리 사용을 줄이고 문자를 만드는 시간도 줄어들기 때문에, 성능도 최적화 할 수 있다.**&#x20;
  * 참고로 문자열 풀은 힙 영역을 사용한다. 그리고 문자열 풀에서 문자를 찾을 때는 해시 알고리즘을 사용하기 때문에, 매우 빠른 속도로 원하는 `String` 인스턴스를 찾을 수 있다.&#x20;
* **따라서 문자열 리터럴을 사용하는 경우 같은 참조값을 가지므로, `==`(동일성) 비교에 성공한다.**&#x20;

#### **주의할 점**&#x20;

그렇다면 문자열 리터럴을 사용하면 `==` 비교를 하고, `new String()` 을 직접 사용하는 경우에만 `equals()` 비교를 사용하면 되지 않을까?&#x20;

정답은 아니다..&#x20;

**개발을 하다보면 협업을 하게 되는데, 문자열 리터럴을 사용하는지 `new String()` 을 사용하는지는 알 수 없다..** \
**때문에! 안전하게 `equals()` 를 사용하는 것이 좋다.**&#x20;

## String 클래스 - 불변 객체&#x20;

**`String` 은 불변 객체이다. 따라서 변경이 필요한 경우 기존 값을 변경하지 않고 새로운 결과를 만들어서 반환한다.**&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2025-04-01 17.24.07.png" alt=""><figcaption></figcaption></figure>

* `String.concat()` 은 내부에서 새로운 `String` 객체를 만들어서 반환한다.&#x20;
* 따라서 불변과 기존 객체의 값을 유지한다.&#x20;

### String 이 불변으로 설계된 이유&#x20;

`String` 이 불변으로 설계된 이유는 앞서 불변 객체에서 배운 내용에 추가로 다음과 같은 이유도 있다.&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2025-04-01 17.26.22.png" alt=""><figcaption></figcaption></figure>

* `String` 은 리터럴의 겨우 자바 내부에서 문자열 풀을 통해서 최적화를 한다.&#x20;
* 만약 `String` 내부의 값을 변경할 수 있다면(불변이 아니라면), 기존에 문자열 풀에서 같은 문자를 참조하는 변수의 모든 문자가 함께 변경되어 버리는 문제가 발생한다.&#x20;
* 위 그림의 경우 `str3` 이 참조하는 문자를 변경하면 `str4` 의 문자도 함께 변경되는 사이트 이펙트 문제가 발생한다.&#x20;
* 하지만, `String` 클래스는 불변으로 이러한 사이드 이펙트 문제를 고려하지 않아도 된다.&#x20;
