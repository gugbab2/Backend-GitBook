---
description: 개
---

# 프로세스와 스레드 소개

## 1. 멀티태스킹과 멀티프로세싱&#x20;

### 단일 프로그램 실행&#x20;

* 만약 프로그램을 2개 이상 동시에 실행한다고 가정해보자. 여기서는 연산을 처리하는 CPU 코어가 1개만 있다고 가정하겠다.
  * 예를 들어, 음악 프로그램과 워드 프로그램을 동시에 실행 시킨다고 생각하자.
* 프로그램의 실행이란 프로그램을 구성하는 코드를 순서대로 CPU 에서 연산(실행) 하는 일이다.&#x20;
* 여기서 CPU 코어는 하나로 가정하므로, 한 번의 하나의 프로그램 코드만 실행할 수 있다.&#x20;
* 이 때, 하나의 프로그램 안에 있는 코드를 모두 실행한 후에야 다른 프로그램 코드를 실행할 수 있다면? (동기)
  * 예를 들어, 음악 프로그램이 끝난 뒤에야 워드 프로그램을 실행할 수 있다면 사용자는 매우 답답하다 ;;
* 실제로 초창기 컴퓨터는 이 처럼 한 번에 하나의 프로그램만 실행했다.
* 이를 해결하기 위해서 하나의 CPU 코어로 여러 프로그램을 동시에 실행하는 **'멀티태스킹'** 기술이 등장했다.&#x20;

### 멀티 태스킹&#x20;

* 순서대로 쵤영한 연속된 사진을 빠르게 교차해서 보여줄 경우 사람은 이를 움직이는 영상으로 인지한다.&#x20;
* 현대의 CPU 는 초당 수십억 번 이상의 연상을 수행한다. 쉽게 이야기해서 초당 수십억 장의 사진이 빠르게 교차되는 것이다.&#x20;
* 만약, CPU 가 매우 빠르게 두 프로그램 코드를 번갈아 수행한다면, 사람이 느낄 때 두 프로그램이 동시에 실행되는 것처럼 느껴질 것이다.&#x20;
* 이렇게 각 프로그램의 실행 시간을 분할해서 마치 동시에 실행되는 것 처럼 하는 기법을 시분할 기법이라 한다.&#x20;
  * 이런 방식을 사용하면 CPU 코어가 하나만 있어도, 여러 프로그램이 동시에 실행되는 것 처럼 느낄 수 있다.&#x20;
* **이렇게 하나의 컴퓨터 시스템(CPU) 이 동시에 여러 작업을 수행하는 능력을 멀티태스킹이라 한다.**&#x20;

> 참고 : CPU 에서 어떤 프로그램이 얼마 만큼의 시간동안 실행될지는 운영체제가 결정하는데, **이것을 스케줄링(scheduling) 이라고 한다.** 이때 단순히 시간으로만 작업을 분할하지는 않고, CPU 를 최대한 활용할 수 있는 다양한 우선순위와 최적화 기법을 사용한다.

### 멀티 프로세싱

> 참고 : CPU 안에는 실제 연산을 처리할 수 있는 코어라는 것이 있다. 과거에는 하나의 CPU 안에 보통 하나의 코어만 들어있었다. 그래서 CPU 와 코어를 따로 분리해 말하지 않았다. 최근에는 하나의 CPU 안에 보통 2개 이상의 코어가 들어가 있다.&#x20;

* CPU 코어가 2개라면 물리적으로 동시에 2개의 프로그램을 처리할 수 있다.
* 프로그램이 2개보다 많아진다면, 운영체제 스케줄링에 의해서 각각의 코어로 프로그램의 실행이 할당된다.&#x20;
* **멀티프로세싱은 컴퓨터 시스템에서 둘 이상의 프로세서(CPU)를 사용하여 여러 작업을 동시에 처리하는 기술을 의미한다.**&#x20;
  * 멀티프로세싱 시스템은 하나의 CPU 코어만을 사용하는 시스템보다 동시에 더 많은 작업을 처리할 수 있다.&#x20;

#### 멀티프로세싱 vs 멀티태스킹&#x20;

* 멀티프로세싱 (하드웨어 장비의 관점)
  * 여러 CPU 코어를 사용해 동시에 여러 작업을 수행하는 것을 의미
  * 하드웨어 기반으로 성능을 향상시킨다.&#x20;
* 멀티태스킹 (운영체제 소프트웨어의 관점)
  * 단일 CPU 가 여러 작업을 동시에 수행하는 것처럼 보이게 하는 것을 의미
  * 소프트웨어 기반(운영체제 스케줄러) 으로 CPU 시간을 분할하여 각 작업에 할당&#x20;

## 2. 프로세스와 스레드&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2024-10-08 00.29.13.png" alt=""><figcaption></figcaption></figure>

### 프로세스&#x20;

* 프로그램은 실제 실행 전까지는 단순한 파일에 불과하다.&#x20;
* 프로그램을 실행하면 프로세스가 만들어지고 프로그램이 실행된다.&#x20;
* **이렇게 운영체제 안에서 실행중인 프로그램을 프로세스라고 한다.**&#x20;
* 프로세스는 실행 중인 프로그램의 인스턴스이다.&#x20;

> 참고 : 각 프로세스는 독립적인 메모리 공간을 갖고 있으며, 운영체제에서 별도의 작업 단위로 분리해서 관리된다. 각 프로세스는 별도의 메모리 공간을 갖고 있기 때문에, 서로 간섭하지 않는다. 그리고 프로세스가 서로의 메모리의 접근할 수 없다.. 프로세스는 이렇듯 서로 격리되어 관리되기 때문에, 하나의 프로세스가 문제가 생겨도 다른 프로세스에 영향을 주지 않는다.&#x20;

#### 프로세스 메모리 구성&#x20;

* 공유 메모리&#x20;
  * 코드 섹션 : 실행할 프로그램의 코드가 저장되는 부분&#x20;
  * 데이터 섹션 : 전역 변수 및 정적 변수가 저장되는 부분&#x20;
  * 힙 : 동적으로 할당되는 메모리 영역&#x20;
* 개별 메모리&#x20;
  * 스택 : 메서드 호출 시 생성되는 지역 변수와 반환 주소가 저장되는 영역&#x20;

### 스레드&#x20;

* 프로세스는 하나 이상의 스레드를 반드시 포함한다.&#x20;
* **스레드는 프로세스 내에서 실행되는 작업의 단위이다.** 한 프로세스 내에서 여러 스레드가 존재할 수 있으며, 이들은 프로세스가 제공하는 동일한 메모리 공간을 공유한다.&#x20;
* 스레드는 프로세스보다 단순하므로, 생성 및 관리가 단순하고 가볍다.&#x20;

> #### **경량 프로세스? ( = 스레드)**&#x20;
>
> * 스레드가 경량 프로세스로 불리는 이유는 스레드가 일반 프로세스에 비해 상대적으로 **가벼운 리소스를 사용**하면서 **효율적으로 작업을 분할**하기 때문입니다.
>   * **메모리 공간 공유**
>     * 여러 스레드는 같은 프로세스 내에서 메모리 공간을 공유한다. 즉, 코드, 데이터, 힙 영역을 공유하여 별도로 메모리를 할당할 필요가 없기 때문에, 리소스가 절약된다.&#x20;
>     * 일반적인 프로세스는 독립적인 메모리 공간을 사용해, 생성할 때마다 새로운 메모리 할당이 필요하다. 반면, 스레드는 메모리를 공유해 상대적으로 경량이다.&#x20;
>   * **컨텍스트 스위칭 비용 절감**&#x20;
>     * 프로세스간 컨텍스트 스위칭에는 CPU 레지스터와 메모리 맵을 전환하는 작업이 필요해 많은 비용이 든다.&#x20;
>     * 반면, 스레드 간의 컨텍스트 스위칭은 상대적으로 간단해 더 빠르고, 시스템 리소스를 덜 소모한다.&#x20;
>   * **빠른 생성 및 종료**&#x20;
>     * 같은 프로세스 내 자원을 공유하기 때문
>   * **통신 비용 감소**&#x20;
>     * 같은 프로세스 내 자원을 공유하기 때문

#### 프로그램이 실행된다는 것은 어떤 의미인가?&#x20;

* 프로그램을 실행하면 운영체제는 보조기억장치 안에 있는 파일 덩어리인 프로그램을 메모리로 불러서 프로세스를 만든다.&#x20;
* **프로그램이 실행 된다는 것은 사실 프로세스 안에 있는 코드가 한 줄씩 실행되는 것이다.**&#x20;
* **이 코드를 한줄씩 실행하는 주체가 스레드이다.** \
  **-> 이렇듯 프로세스의 코드를 실행하는 흐름을 스레드라고 한다.**&#x20;

#### 멀티 스레드가 필요한 이유&#x20;

* 하나의 프로그램도 그 안에서 동시에 여러 작업이 필요하다.&#x20;
  * 워드 프로그램으로 문서를 편집하면서, 자동으로 저장하고, 맞춤법 검사도 함께 수행된다.&#x20;
  * 유튜브를 보면서 댓글을 달 수 있다.&#x20;

## 3. 스레드와 스케줄링&#x20;

* 다음의 상황을 가정하자.
  * CPU 코어는 1개이고, 프로세스는 2개이다.&#x20;
  * 프로세스 A 는 스레드 1개 이고,&#x20;
  * 프로세스 B 는 스레드 2개 이다.&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2024-10-08 00.42.29.png" alt="" width="563"><figcaption></figcaption></figure>

### 단일 코어 스케줄링&#x20;

* 운영체제가 스레드를 어떻게 스케줄링 하는지, 스케줄링 관점으로 알아보자&#x20;
* 운영체제는 내부에 스케줄링 큐를 가지고 있고, 각각의 스레드는 스케줄링 큐에서 대기한다.&#x20;
* 운영체제 스케줄링 큐에 저장된 순서대로 단일 코어의 자원을 사용하고 반납하고를 반복한다.&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2024-10-08 00.45.12.png" alt="" width="563"><figcaption></figcaption></figure>

### 멀티 코어 스케줄링&#x20;

* 코어가 늘어나게 되면 사용할 수 있는 자원이 늘어났다는 것을 의미하고, 일반적으로 더 좋은 성능을 제공한다.&#x20;

<figure><img src="../../../../.gitbook/assets/스크린샷 2024-10-08 00.46.41.png" alt="" width="563"><figcaption></figcaption></figure>

## 4. 컨텍스트 스위칭&#x20;

* 멀티태스킹이 반드시 효율적인 것은 아니다.&#x20;

### 컴퓨터의 멀티태스킹&#x20;

* 운영체제의 멀티태스킹을 생각해보자. CPU 코어는 하나만 있다고 가정하자.&#x20;
* 스레드A, 스레드B 가 있다.&#x20;
* 운영체제는 먼저 스레드 A 를 실행한다. 멀티태스킹을 해야 하기 때문에, 스레드 A 를 잠시 멈추고, 스레드 B 를 실행한다. 이후에 스레드 A 로 그냥 돌아갈 수 없다. CPU 에서 스레드를 실행하는데, 스레드 A 의 코드가 어디까지 수행되었는지 위치를 찾아야 한다. 그리고 계산하던 변수의 값을 CPU 로 다시 불러들여야 한다.&#x20;
* **스레드 A 를 멈추는 시점에 이러한 값들을 메모리에 저장해두어야 한다. 그리고 이후에 스레드 A 를 다시 실행할 때 이 값들을 CPU 에 다시 불러와야 한다.** \
  **-> 결과적으로 비용이 발생한다.**&#x20;
* **이런 과정을 컨텍스트 스위칭(context switching) 이라고 부른다.**&#x20;

### 참고 - 실무 이야기&#x20;

* **CPU 코어 갯수와 스레드의 갯수를 일치시키거나, 스레드 대기 상태를 고려해 CPU 코어 갯수보다 1개 더 많게 스레드 갯수를 맞춘다면 이상적이라고 생각할 수 있다.**&#x20;
* **하지만, 이상적이지 못한 경우도 있다..**

#### CPU 바운드 작업 vs I/O 바운드 작업&#x20;

* **CPU 바운드 작업**&#x20;
  * CPU 의 연산 능력을 많이 요구하는 작업을 의미한다.&#x20;
  * 이러한 작업은 주로 계산, 데이터 처리, 알고리즘 실행 등 CPU 처리 속도가 작업 완료 시간을 결정하는 경우다 .
  * CPU 를 거의 100% 사용하는 작업이므로 스레드를 CPU 숫자에 최적화
* **I/O 바운드 작업**
  * 디스크, 네트워크, 파일 시스템 등과 같은 입출력 작업을 많이 요구하는 작업을 의미한다.&#x20;
  * 이러한 작업은 I/O 작업이 완료될 때까지 대기 시간이 많이 발생하며, CPU 는 상대적으로 대기 상태에 있는 경우가 많다.&#x20;
  * 쉽게 이야기해서 스레드가 CPU 를 사용하지 않고 I/O 작업이 완료될 때까지 대기한다.&#x20;
  * CPU 를 많이 사용하지 않으므로 성능 테스트를 통해 CPU 를 최대한 활용하는 숫자까지 스레드 생성, 단 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 함께 증가\
    \-> 적절한 성능 테스트가 필요!
  * **대기 시간에는 CPU 자원을 반납한다.**&#x20;

#### 웹 애플리케이션 서버&#x20;

* 웹 서버의 경우 CPU 바운드 작업보다는, I/O 바운드 작업이 많다.&#x20;
* 일반적인 자바 웹 애플리케이션 서버의 경우 사용자의 요청 하나를 처리하는데 1개의 스레드가 필요하다. 사용자 4명이 동시에 요청하면 4개의 스레드가 작동하는 것이다.&#x20;
* 만약, 사용자의 요청 하나를 처리하는데, 스레드는 CPU 1% 정도 사용하고, 대부분 데이터베이스 서버에 어떤 결과를 조회하면서 기다린다고 가정하자. 이때는 스레드는 CPU 를 거의 사용하지 않고 대기한다. \
  \-> I/O 바운드 작업이 많다는 것을 의미한다.&#x20;
* 이 경우 CPU 코어가 4개 있다고해서 쓰레드 숫자도 CPU 코어에 맞추어 4개로 설정하면 안된다. 그러면 동시에 4명의 사용자 요청만 처리할 수 있다. 이 때 CPU 는 단순하게 계산해서 4% 정도만 사용하고, 나머지는 놀고 있는 상황이 발생할 것이다..
* 사용자의 요청 하나를 처리하는데 CPU 를 1% 만 사용한다면 단순하게 생각해도, 100 개의 스레드를 만들 수 있다. 이렇게 하면 동시에 100명의 사용자 요청을 받을 수 있다. 물론 실무에서는 성능 테스트를 통해서 최적의 스레드 숫자를 찾는 것이 이상적이다.&#x20;
* 결국 스레드 숫자만 늘리면 되는데, 이런 부분을 이해하지 못해서, 서버 장비에 문제가 있다고 생각하는 경우가 있다.&#x20;
