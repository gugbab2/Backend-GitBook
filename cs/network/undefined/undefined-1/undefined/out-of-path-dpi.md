# Out of path 구조와 DPI 그리고 망중립

## Out of path 구조(Sensor)

<figure><img src="../../../../../.gitbook/assets/스크린샷 2024-01-12 16.23.28.png" alt=""><figcaption></figcaption></figure>

* Out of path 구조는 쉽게 센서(Port Mirroring) 로 생각할 수 있다.
* Out of path 센서와 연결되는 대표적인 장치는 L2 스위치이다.&#x20;
  * **L2 스위치는 미러링 용 포트를 가지고 있고, 포트간의 통신 정보들을 미러링 용 포트를 통해 센서에 전달한다.**
  * **해당 작업은 부하가 심한 작업이기 때문에, 높은 성능을 필요로 한다.**
  * 미러링 전용 스위치(Tab Switch) 도 존재한다. (가격이 비싸다 ;;)

<figure><img src="../../../../../.gitbook/assets/스크린샷 2024-01-12 17.09.01.png" alt=""><figcaption></figcaption></figure>

* L2 스위치를 통해서 센터로 Ethernet Frame 이 전달되면, 프로세스(L7)로 정보가 전달되고 수집하게되며, \
  수집된 정보를 바탕으로 분석하게 된다.&#x20;
* 이 수집의 과정을 보조기억장치에 Write 한다고 생각할 수 있는데,
* **무조건적으로 네트워크에서 데이터가 전달되는 속도가 보조기억장치에 Write 속도보다 빠르다!**
  * **속도차로 인한 손실이 발생할 수 있고,**&#x20;
  * **무손실 스캐너 장비의 가격은 무시무시하다 ;;**

## DPI 그리고 망중립

<figure><img src="../../../../../.gitbook/assets/스크린샷 2024-01-12 16.43.07.png" alt=""><figcaption></figcaption></figure>

#### 대한민국 유해사이트 차단 방식: ISP와 DNS/HTTP의 역할

대한민국에서 유해사이트를 국가적으로 차단하는 방식은 주로 **ISP(인터넷 서비스 제공업체) 단계에서 DNS(Domain Name System) 차단과 HTTP 리다이렉션(Redirection)**&#xC744; 통해 이루어집니다.

1. **ISP 센서 (모니터링 시스템)의 역할**
   * 사용자가 유해사이트의 도메인 이름(예: example.com)에 접속하려 할 때, 가장 먼저 해당 도메인의 IP 주소를 알아내기 위해 ISP의 DNS 서버에 질의한다.
   * ISP의 DNS 서버는 정부 기관(예: 방송통신심의위원회)으로부터 전달받은 유해사이트 목록을 가지고 있다. 사용자가 질의한 도메인이 이 목록에 있으면, DNS 서버는 해당 유해사이트의 실제 IP 주소 대신, **차단 안내 페이지의 IP 주소(예: `192.168.1.1`과 같은 내부망 IP 또는 특정 차단 서버 IP)**&#xB97C; 응답으로 보내줍니다.
2. **Only Read와 빠른 응답:**
   * DNS 차단 방식의 경우, ISP의 DNS 서버는 사용자 요청을 받고 DB를 조회하여 바로 응답을 주기 때문에, 유해사이트의 실제 서버보다 **훨씬 빠르게 차단 페이지의 IP 주소를 사용자에게 전달**할 수 있다.&#x20;
   * 이 방식은 트래픽 자체를 중간에서 가로채거나 수정하는 것이 아니기 때문에, 망중립성 원칙을 비교적 덜 침해하면서도 효과적인 차단을 가능하게 한다.
3. **망 중립성 원칙:**
   * "국가가 지정하는 유해사이트(포르노, 마약 ..)를 제외하고는 접근 제한을 해서는 안된다. (망중립의 원칙)" 이 부분은 매우 중요하다.&#x20;
   * **망 중립성(Net Neutrality)**&#xC740; 모든 인터넷 트래픽을 동등하게 취급해야 하며, 데이터의 종류, 출발지, 목적지 등에 따라 차별해서는 안 된다는 원칙이다.&#x20;
   * 따라서 ISP는 정부의 법적 근거에 따라 지정된 불법 유해사이트(불법 도박, 불법 음란물, 마약 등)에 대해서만 접근을 제한하며, 그 외의 합법적인 콘텐츠에 대해서는 어떠한 차별도 가해서는 안 됩니다.
4. **HTTP 통신 및 L7 계층:**
   * "유해사이트에 대한 응답으로 주고 있는 것들은 HTTP 이다. 이것을 한번 더 생각해보면 L7 HTTP 통신이 이루어지고 있다는 말이 된다."
   * 사용자가 차단 안내 페이지의 IP 주소를 받은 후, 웹 브라우저는 해당 IP 주소로 HTTP 요청을 보냅니다.
   * 이 요청은 ISP 내부의 **차단 서버**로 전달되고, 이 서버는 "접속이 차단되었습니다"와 같은 메시지가 포함된 **HTTP 응답(L7)**&#xC744; 사용자 브라우저에게 돌려줍니다.
   * 즉, 차단 서버는 L7(애플리케이션 계층)에서 HTTP 프로토콜을 사용하여 차단 안내 페이지를 제공하는 것입니다. 이는 단순한 네트워크 단의 차단을 넘어선 애플리케이션 계층에서의 상호작용입니다.

<figure><img src="../../../../../.gitbook/assets/스크린샷 2024-01-12 16.58.26.png" alt=""><figcaption></figcaption></figure>

* 다음과 같이 IP, TCP 헤더를 Packet 의 헤더,&#x20;
* HTTP 헤더(SPI), 그 외 부분(DPI)을 Packet 의 Payload 라 부른다.&#x20;
* **대한민국은 SPI 의 정보수집이 허용된 나라이며, DPI 정보수집(저장)은 도감청에 해당되는 범죄이다.**&#x20;
  * **DPI 가 허용된다는 것은, 개인정보가 모두 노출되는다는 것을 의미하기에 상당히 민감한 사회문제이다.**&#x20;
