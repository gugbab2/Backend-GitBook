# 12. 프로세스 동기화

## 1. 동기화란?&#x20;

동시다발적으로 실행되는 프로세스들은 공동의 목적을 올바르게 수행하기 위해 서로 협력하며 영향을 주고 받기도 한다. 이렇게 협력하여 실행되는 프로세스들은 실행 순서와 자원의 일관성을 보장해야 하기 때문에, "동기화(synchronization)" 되어야 한다.&#x20;

### 1.1 동기화의 의미&#x20;

동시다발적으로 실행되는 많은 프로세스는 서로 데이터를 주고받으며 협력하며 실행될 수 있다. 예를 들어, 워드 프로그램 내에서 돌아가는 각각의 프로세스들은 각기 다른 독립적인 프로세스지만 공동의 목표를 위해 서로 협력하는 존재이다.&#x20;

이렇게 협력적으로 실행되는 프로세스들은 아무렇게나 마구 동시에 실행되어서는 안된다. 올바른 실행을 위해서는 "동기화"가 필수적이다.&#x20;

"프로세스 동기화"란 프로레스들 사이의 수행 시기를 맞추는 것을 의미한다. 크게 아래 두 가지를 일컫는다.&#x20;

* 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기&#x20;
* 상호 배체 : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기&#x20;

#### 실행 순서 제어 동기화&#x20;

가령 write 프로세스와 reader 프로세스가 실행중이라고 가정해보자. 이 두 프로세스는 무작정 아무 순서대로 실행되어서는 안된다. reader 프로세스는 writer 프로세스 실행이 끝나야 비로소 실행할 수 있기 때문이다. 이렇게 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것이 "실행 순서 제어 동기화"이다.&#x20;

#### 상호 배제 동기화&#x20;

"상호 배제" 는 공유가 불가능한 자원의 동시 사용을 피하기 위해서 사용하는 알고리즘이다. 은행 앱에서 2개의 출금이 있다고 했을 때 2개의 출금이 동시에 잔액에 접근하면 무시무시한 버그가 발생할 수 있다.&#x20;

* 자바에서는 synchronized 를 통해서 간단하게 제어&#x20;

### 1.2 생산자 소비자 문제&#x20;

### 1.3 공유 자원과 임계 구역

## 2. 동기화 기법&#x20;

어떻게 해야 임계 구역에 오직 하나의 프로세스만 진입하게 하고, 올바른 실행순서를 보장할 수 있을까? 이를 위해 동기화를 위한 대표적인 도구인 "뮤텍스 락", "세마포어", "모니터" 를 학습해보자.&#x20;

### 2.1 뮤텍스 락&#x20;

임계 구역 문제와 이를 해결하기 위한 동기화를 옷 가게에서 탈의실을 이용하는 것에 비유해보자. 옷 가게에서 마음에 드는 옷이 있으면 손님은 탈의실에 들어가서 옷을 입어볼 수 있습니다. 이때 탈의실에는 한 명의 인원만 들어갈 수 있습니다. 손님들은 탈의실이라는 자원을 이용하고 탈의실 안에는 손님 한 명씩만 들어올 수 있으니, 손님은 "프로세스", 탈의실은 "임계구역" 이라고 할 수 있다.&#x20;

만약 밖에서 탈의실에 사람이 있는지 없는지 알 수 없는 상황이라면 여러분은 어떻게 탈의실이 사용중임을 알 수 있을까? 일단 탈의실을 열어 보고 자물쇠가 걸려 있다면 탈의실 안에 사람이 있다고 판단하고 기다린다. 자물쇠가 걸려 있지 않다면 탈의실을 이용하면 되는 것이다.&#x20;

이 자물쇠 기능을 코드로 구현한 것이 "뮤텍스 락(mutex lock)" 이다. 뮤텍스 락은 동시에 접근해서는 안 되는 자원에 동시에 접근하지 않도록 만드는 도구, 다시 말해 상호 배제를 위한 동기화 도구이다.&#x20;

임계 구역에 진입하는 프로세스는 '내가 지금 임계 구역에 있음' 을 알리기 위해 뮤텍스 락을 이용해 임계 구역에 자물쇠를 걸어둘 수 있고, 다른 프로세스는 임계 구역이 잠겨 있다면 기다리고, 잠겨 있지 않다면 임계 구역에 진입할 수 있다.&#x20;

뮤텍스 락의 매우 단순한 형태는 하나의 전역 변수와 두 개의 함수로 구현할 수 있다.&#x20;

* 자물쇠 역할 : 프로세스들이 공유하는 전역 변수 lock&#x20;
* 임계 구역을 잠그는 역할 : aquire 함수&#x20;
* 임계 구역의 잠금을 해제하는 역할 : release 함수&#x20;

### 2.2 세마포어&#x20;

"세마포어(semaphore)" 는 뮤텍스 락과 비슷하지만, 조금 더 일반화된 방식의 동기화이다. 뮤텍스 락은 하나의 공유 자원에 접근하는 프로세스를 상정한 방식이다. 하지만 탈의실이 여러 개 있는 상황처럼 공유 자원이 여러 개 있을 경우 여러 개의 프로세스가 각각 공유 자원에 접근이 가능해야 한다.

이처럼 세마포어는 공유 자원이 여러 개 있는 상황에서도 적용할 수 있는 동기화 도구이다.&#x20;
