# 전술적 설계 - AGGREGATE 와 REPOSITORY

## AGGREGATE&#x20;

* DDD 를 하게 되면 무수한 VALUE OBJECT, ENTITY 가 등장하게 되고, 이는 분할의 결과물이다.&#x20;
* 관련 객체를 하나로 묶은 군집을 AGGREGATE 라고 부른다. (논리적 의미)&#x20;
* 애그리거트로 묶어서 바라보면 좀 더 상위 수준에서 도메인 모델 간의 관계를 파악할 수 있다.&#x20;
* 애그리거트에 속한 객체는 유사하거나 동일한 라이프사이클을 갖는다. (헷갈린다;;)&#x20;
  * 라이프사이클이 동일하지 않은 경우가 많다. &#x20;
  * 비지니스 로직을 수행해야 할 단위&#x20;
  * 불변식을 지킨다.&#x20;
    * 불변식 : 비지니스 규칙&#x20;
      * ex, 강의의 수강생은 25명을 넘을 수 없다.&#x20;
* 한 애그리거트에 속한 객체는 다른 애그리거트에 속하지 않는다.&#x20;
* 두 개 이상의 엔티티로 구성되는 애그리거트는 드물게 존재한다.&#x20;

## AGGREGATE ROOT&#x20;

* 애그리거트 루트의 핵심 역할은 애그리거트의 일관성이 깨지지 않도록 하는 것이다.
  * 일관성 : 애플리케이션에서 ACID 를 지키는 단위이다.
  * **ACID 를 지키기 위해서 직접 참조가 아닌, 간접 참조를 해야한다.**
* 애그리거트 루트는 애그리거트가 제공해야 할 도메인 기능을 구현한다.&#x20;
  * ex, 학급에서 가정통신문을 분배할 때, 반장이 가정통신문을 나누어준다.&#x20;
* 이는 애그리거트의 내부 구현을 숨겨서 애그리거트 단위로 구현을 캡슐화할 수 있도록 돕는다.
* 루트 엔티티는 애그리거트에 속해 있는 엔티티와 밸류 객체를 이용해서 애그리거트가 구현해야 할 기능을 제공한다.

## REPOSITORY&#x20;

* JPA REPOSITORY, DDD REPOSITORY 는 다르다.&#x20;
* 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의하는 클래스를 DDD REPOSITORY 라고 부른다.&#x20;
* 때문에, 애그리거트를 구하는 레포지터리 메서드는 완전한 애그리거트를 제공해야 한다.&#x20;
* **레포지토리는 애그리거트 루트 단위로 존재하며 테이블 단위로 존재하는 것이 아니다.**&#x20;
  * **만약 테이블 단위로 레포지토리가 존재한다면 DDD 입장의 레포지토리는 아니다.**&#x20;
  * JPA 레포지토리는 테이블 단위로 존재한다. (라이브러리 상속 강제)&#x20;
  * DDD 입장에서&#x20;
