# chapter 2. LLM 기반의 에이전트 기술 기반 체계

## 2.1 에이전트 네가지 핵심 요소&#x20;

에이전트가 중심에서 여러 구성 요소들을 협력하는 하는 것으로 복잡한 작업과 의사 결정 과정을 처리한다.&#x20;

* **계획(planing)**&#x20;
  * 에이전트는 복잡한 작업을 효과적으로 수행하기 위한 계획 능력과 의사 결정 능력이 필요하다.&#x20;
  * 여기에는 작은 목표로 분할, 사고의 연쇄, 자기 성찰과 비판, 과거 행동에 대한 성찰이 포함된다.&#x20;
* **기억(memory)**&#x20;
  * 단기 기억과 장기 기억의 두 부분으로 구성된다.
  * 단기 기억은 맥락 학습과 관련이 있는 프롬프트 엔지니어링의 일부이다.&#x20;
  * 장기기억은 정보의 장기 저장 및 검색과 관련이 있으며, **일반적으로 외부 벡터 스토리지와 빠른 검색을 활용한다.**&#x20;
* **도구(tool)**&#x20;
  * 에이전트가 호출할 수 있는 다양한 도구들을 포함한다.&#x20;
  * 예를 들어 달력, 계산기, 코드 해석기, 검색 기능 등이 여기에 해당된다.&#x20;
  * **LLM 은 사전학습이 완료되면 기본적으로 내부 능력과 지식의 한계가 해당 시점으로 고정되며 확장하기 어려운 특성을 지니므로, 이러한 도구들이 중요하다.**
* **실행(action)**&#x20;
  * 에이전트는 계획과 기억을 바탕으로 구체적인 행동을 실행한다.&#x20;
  * 여기에는 외부 세계와의 상호작용이나 도구를 하출하여 작업을 완료하는 것이 포함될 수 있다.&#x20;

### 에이전트 추론 흐름도&#x20;

1. 작업 수신 : 에이전트는 먼저 프롬프트를 통해 요청, 외부 추가 지식, 인물 설정을 읽어 작업을 수신한다.&#x20;
2. 기억 갱신 : 에이전트는 특정 작업에 따라 시스템의 기억을 갱신하여 처리 과정에서 필요한 모든 관련 정보를 최신 상태로 유지한다.&#x20;
3. 기억 검색 : 기억이 방대할 가능성이 있기 때문에 관련 정보를 검색하거나 필요한 경우 데이터를 잘라내어 효율적으로 처리할 수 있게 한다.&#x20;
4. 작업 계획 : LLM 은 이전 단계에서 제공된 구조화된 도구, 기억, 요청 프롬프트를 바탕으로 작업 이름을 포함한 계획을 생성한다. 이 계획은 후속 단계와 작업을 포함하고 있으며, 사용해야 할 도구와 매개변수를 설명한다.&#x20;
5. 도구 실행 : '작업 계획' 모듈에서 작업 완료 신호가 생성되면, 순환이 종료되고 에이전트에게 작업이 완료되었다고 알려 결론을 생성한다. 그렇지 않으면 시스템은 지정된 도구를 호출하고 실행한다. LLM 으느 도구가 생성한 지정된 형식의 결과를 관찰한 후 이를 작업 기억과 통합한다.&#x20;
6. 결론 도출 : 시스템은 최종 답변을 요약하고 작업 처리 과정을 마친다.&#x20;

## 2.2 에이전트의 계획 및 의사 결정 능력&#x20;

LLM 이 에이전트에게 부여하는 계획과 의사 결정 능력은 매우 중요하다.&#x20;

**계획은 복잡한 작업을 더 작고 관리하기 쉬운 하위 작업으로 분해하는 과정이다.** 이 과정은 우리가 작업을 더 잘 이해하고 완료하는데 도움을 준다.&#x20;

* 연구자들이 제안한 계획 기술에는 작업 분해, 외부 계획기와의 결합, 자기 성찰 등이 포함된다.&#x20;

**작업 분해에는 다음과 같은 기술이 포함되어 있다.**&#x20;

* 사고의 연쇄 : 이것은 모델이 '단계별로 생각하도록' 유도하는 프롬프트 기술로, 이를 통해 모델이 큰 작업을 작은 작업으로 분해하고 자신의 사고 과정을 명확하게 설명하게 할 수 있다.&#x20;
* 사고의 나무 : 각 단계에서 다양한 추론 가능성을 탐색함으로써 트리 구조를 형성한다. 사고의 나무는 BFS, DFS 과 같은 다양한 검색 방법을 사용할 수 있으며, 프롬프트나 투표를 통해 각 단계를 평가할 수 있다.&#x20;
* 이 외에도 간단한 프롬프트, 특정 작업에 대한 명령, 직접 수동을 분해하는 등의 방식으로 작업 분해를 수행할 수 있다.&#x20;

**외부 계획기와 결합을 대표하는 것은 'LLM+P' 방법이다.**&#x20;

* 본질적으로 계획 단계는 외부 도구에 위탁되며, 이러한 방법은 일부 로봇 설정에서 흔히 사용된다.&#x20;

**자기 성찰에는 다음 기술이 포함된다.**&#x20;

* ReAct : 이 기반 체계에는 특정 작업의 행동과 언어 공간을 결합하여 모델이 환경과 상호작용하고 추론 궤적을 생성할 수 있도록 한다.&#x20;
* Reflexion : 이 기반 체계는 에이전트가 동적 기억과 자기 성찰 능력을 갖출 수 있도록 한다. 이를 통해 에이전트는 과거의 행동을 회고하는 추론 능력을 향상시킬 수 있다.&#x20;
* CoH(chain of hindsight) : 이 방법은 LLM 에게 일련의 피드백이 포함된 과거 출력을 보여주고 이를 바탕으로 자신의 출력을 개선하도록 권장한다.&#x20;

이어서 **ReAct 기반 체계** / **도구 호출**이라는 에이전트의 핵심 기능 두 가지를 소개한다.&#x20;

ReAct 기방 체계는 대표적인 에이전트 추론 기반 체계로, 에이전트의 동적 성격과 적응성에 중점을 둔다. 에이전트는 ReAct 기반 체계에서 작업에 대한 추론을 할 수 있을 뿐 아니라 상황 변화에 따라 스스로 행동하고 조정할 수 있다. ReAct 기반 체계는 에이전트 설계에서 순환적인 상호작용 형태의 과정을 보여준다. **에이전트는 먼저 현재 상태를 감지하고, 그 결과에 따라 결정을 내리고 행동을 취하며 다시 행동의 결과와 그에 따른 상태 변화를 바탕으로 조정을 진행한다. 그리고 그 과정은 반복된다.** ReAct 기반 체계는 에이전트를 더 유연하게 바꾸고 더 강한 적응력을 부여해 복잡하고 변화무쌍한 환경에서도 효과적으로 작업할 수 있도록 한다.&#x20;

도구는 에이전트에 제공된 기능 함수, 코드 조각, 기타 기술 도구를 의미한다. 에이전트는 ReAct 기반 체계를 바탕으로 외부 도구를 사용해 작업이나 하위 작업을 해결하려고 계속 시도하는데, 도구가 호출될 때마다 새로운 결과와 상태 변화가 발생한다. 에이전트는 개발 과정에서 이러한 도구들은 에이전트의 능력을 강화하고 성능과 신뢰성을 보장하는 필수적인 자원과 편의를 제공한다.&#x20;

에이전트는 이 두 가지 결합을 통해 더 지능적이고 자율적으로 성장해가면서 적응력도 강해져 각 분야에 더 많은 가능성을 열어준다.&#x20;

## 2.3 에이전트의 다양한 기억 기제

LLM 이 기억을 형성하는 기제는 다음과 같은 몇 가지로 요약할 수 있다.&#x20;

#### 첫 번째, 사전 학습을 통해 기억을 형성하는 것&#x20;

LLM 은 세계 지식을 포함한 방대한 데이터 묶음으로 사전학습을 한다. LLM 은 이 과정에서 신경망 가중치를 조정하여 인간의 언어를 이해하고 생성하는 방법을 학습하는데, 이를 기억의 형성 과정으로 볼 수 있다.&#x20;

LLM 은 심층 신경망과 경사 하강법 등의 기술을 사용해 입력에 기반한 예측 능력이나 텍스트 생성 능력을 지속적으로 향상시키며, 이를 통해 세계 지식과 장기 기억을 형성하게 된다.&#x20;

#### 두 번째, 상황(context) 과의 상호작용&#x20;

LLM 은 작업을 수행할 때 장기 기억과 프롬프트를 통해 제공된 상황 정보를 결합하여 사용한다. 만약 상황 정보가 LLM 의 기억과 충돌하는 작업 관련 정보를 포함하고 있다면, 이상적으로는 LLM 은 더 정확하고 상황에 맞는 응답을 생성하기 위해 상황 정보를 우선적으로 고려해야 한다.&#x20;

지식 인식형 파인튜닝과 같은 방법을 통해 LLM 이 상황 정보와 기억된 지식을 선택적으로 사용하는 방법의 제어 가능성과 견고성을 강화할 수 있다.&#x20;

#### 세 번째, 특정 작업에 맞게 파인튜닝을 통해 성능을 강화하는 방법&#x20;

LLM 은 보다 구체적인 데이터 묶음에서 추가로 파인튜닝을 수행하여 특정 행동이나 특정 작업의 설능을 향상시킬 수 있다.

예를 들어, 만족 가능성 문제 데이터 묶음에 대해 파인튜닝 된 LLM 은 이러한 유형의 질문에 더욱 능숙하게 답변할 수 있다.&#x20;

#### 네 번째, 메모리 뱅크와 같은 외부 기억 시스템을 LLM 에 통합하여 성능을 강화하는 방법&#x20;

LLM 은 이를 통해 과거의 상호작용을 기억하고 회상하며 사용자의 개성을 이해해 더욱 개인화된 상호작용을 제공할 수 있다.&#x20;

#### 요약&#x20;

LLM 은 다양한 데이터 묶음에서 광범위한 사전학습을 통해 기억을 형성하며, 파인튜닝과 외부 기억 시스템과의 통합을 통해 특정 상황에서 이러한 기억을 더욱 세분화할 수 있다. 이러한 내부 지식과 적응형 학습의 결합은 LLM 을 광범위한 언어 작업을 처리할 수 있는 강력한 도구로 만들어준다.&#x20;

## 2.4 에이전트의 핵심 기술 : 도구 호출&#x20;

현실 세계의 인간은 다양한 도구를 사용하여 자신의 능력을 확장한다. 에이전트 역시 이와  마찬가지로 외부 도구를 호출함으로써 능력을 확장하고 효율성을 높일 수 있다. 도구 호출 능력은 에이전트의 핵심 능력으로 간주된다.&#x20;

따라서 에이전트의 능력과 효율성은 다양한 도구를 얼마나 유연하게 호출하고 활용할 수 있는지에 달려있다.&#x20;

* 이러한 도구는 애플리케이션, 데이터베이스, 머신러닝 모델, 심지어 다른 에이전트일 수도 있다.&#x20;

장미꽃 구매라는 작업을 예로 들어보자. 다음과 같은 단계로 도구를 호출할 수 있다.&#x20;

* 요구사항 파악 : 에이전트는 우선 작업의 요구사항을 이해하고 장미꽃의 평균 시장가격을 확인한다.&#x20;
* 적합한 도구 선택 : 검색 도구를 통해 필요한 정보를 획득한다.&#x20;
* 행동 및 입력 : 구체적인 검색 명령어를 명확히 하여 정확한 데이터를 확보한다.&#x20;
* 피드백 처리 : 검색 결과를 수집한 후, 계산기 도구를 사용해 데이터를 처리하고, 주어진 예산 내에서 구매 가능한 꽃의 양을 계산한다.&#x20;

이 과정은 에이전트의 정밀한 도구 호출 능력과 데이터 획득, 처리의 효율적인 협업을 보여준다. 이러한 방식을 통해서 에이전트는 단순히 작업을 수행하는 것뿐만 아니라 결정 과정을 최적화하여 지능과 실용성을 발휘한다.&#x20;

#### 에이전트 도구 호출의 도전 과제

1. 에이전트는 다양한 유형의 도구를 이해하고 조작할 수 있어야 한다. 이는 복잡한 인터페이스를 해석하고 다양한 데이터 형식을 이해하며 도구를 효과적으로 사용하는 방법을 배우는 것을 포함한다.&#x20;
2. 에이전트는 적절한 시기에 적합한 도구를 선택할 수 있어야 한다. 이를 위해서는 에이전트가 각 도구의 기능, 강점, 한계를 깊이 이해하고 현재 작업과 환경 조건에 맞는 결정을 빠르게 내려야 한다.&#x20;
3. 여러 도구의 사용을 관리할 수 있어야 한다. 복잡한 작업에서는 에이전트가 여러 도구를 동시에 호출하고 이를 도구 간의 협력과 데이터 교환이 원활하게 이루어지도록 해야 한다.&#x20;
