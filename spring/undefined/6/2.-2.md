# 2. 오브젝트와 의존관계2

## 스프링 컨테이너와 의존관계 주입(Dependency Injection)&#x20;

* 우리는 이미 스프링 의존관계 주입을 위한 구조를 만들어두었다. 우리가 만들어 둔 `ObjectFactory` 가 `BeanFactory` 로 변경되기만 하면 된다.&#x20;
* 여기서 빈은 프로그램을 구성하는 오브젝트라고 생각하면 된다.&#x20;

<figure><img src="../../../.gitbook/assets/스크린샷 2024-12-04 19.35.58.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/스크린샷 2024-12-04 19.36.08.png" alt=""><figcaption></figcaption></figure>

* 하지만 스프링의 `BeanFactory` 는 어떤 의존성을 주입해야 하는지 알 수 없다. 때문에 어떤 의존성을 주입해야 하는지를 지정해주는 `ObjectFactory` 를 하나 추가해야 한다.&#x20;
* 여기서 빈은 `PaymentService`, `WebApiExRateProvider` 이고, 어떤 의존성을 주입할 것인지에 대한 구성정보를 `ObjectFactory 에서 설정하게 된다.`

<figure><img src="../../../.gitbook/assets/스크린샷 2024-12-04 19.45.59.png" alt=""><figcaption></figcaption></figure>

* 아래 코드는 위 구조대로 완벽히 스프링으로 변경되었다.&#x20;
  * `beanFactory` 를 통해 빈 정보를 가져왔다.&#x20;
  * `ObjectFactory` 에서 빈 정보를 설정해주었다.&#x20;

```java
package spring.hellospringv3;

import org.springframework.beans.factory.BeanFactory;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import java.io.IOException;
import java.math.BigDecimal;
import java.util.concurrent.TimeUnit;

public class Client {
    public static void main(String[] args) throws IOException, InterruptedException {
        BeanFactory beanFactory = new AnnotationConfigApplicationContext(ObjectFactory.class);
        PaymentService paymentService = beanFactory.getBean(PaymentService.class);

        Payment payment1 = paymentService.prepare(100L, "USD", BigDecimal.valueOf(50.7));
        System.out.println("Payment1 : " + payment1);
    }
}
```

```java
package spring.hellospringv3;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class ObjectFactory {

    @Bean
    public PaymentService paymentService() {
        return new PaymentService(cachedExRateProvider());
    }

    @Bean
    public ExRateProvider exRateProvider() {
        return new WebApiExRateProvider();
    }
}
```

### 의존관계 주입(Dependency Injection)&#x20;

* IoC 는 스프링의 동작원리를 정확하게 설명하기에는 너무 일반적인 프레임워크 동작원리를 설명하는 용어이다.&#x20;
* 때문에, **스프링과 같이 오브젝트의 의존관계에 대한 책임을 스프링 컨데이터와 같이 외부 오브젝트가 담당하도록 만드는 것을 설명하는, 의존관계 주입(Dependency Injection) 패턴**을 줄여서 DI 라고 불리는 용어가 마틴 파울러에 의해서 제안되었고, 스프링 개발자들 사이, 또 이 원칙을 따라서 프레임워크를 만들거나 개발 방식을 설명하는 다른 언어와 기술에서 넓게 사용되고 있다.&#x20;
* 스프링이 처음 등장했던 시기에는 IoC 라는 용어를 주로 사용했기 때문에, 이후에 DI 를 사용하면서도 IoC 라는 용어도 같이 쓰이기도 한다.&#x20;

### 컨테이너&#x20;

* **애플리케이션을 구성하는 오브젝트를 만들어서 담아두고 필요할 때 사용하도록 제공하는 기능을 담당하는 것을 컨테이너라고 한다.**&#x20;
* **보통 오브젝트를 보관하는 것 뿐 아니라, 생명주기(lifecycle) 까지 담당한다.**&#x20;
* **스프링 컨테이너는 빈이라고 부르는 오브젝트를 생성하고 의존관계를 설정하는 것까지 담당한다.**&#x20;

## 싱글톤 레지스트리&#x20;

## DI 와 디자인패턴&#x20;

## 의존성 역전 원칙(DIP)&#x20;

